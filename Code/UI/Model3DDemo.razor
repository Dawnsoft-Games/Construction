@using System;
@using Sandbox;
@using Sandbox.UI;
@using Construction.UI;
@inherits PanelComponent
@namespace Construction.UI

<root class="model3d-demo">
	<div class="demo-container">
		<div class="model-viewer">
			<Model3DPanel @ref="modelPanel"
				Model="@SelectedModel"
				Material="@SelectedMaterial"
				Tint="@ModelTint"
				Scale="@ModelScale"
				EnableRotation="@EnableRotation"
				EnableZoom="@EnableZoom"
				AutoRotate="@AutoRotate"
				AutoRotateSpeed="@AutoRotateSpeed" />
		</div>

		<div class="controls">
			<h2>3D Model Viewer</h2>
			
			<div class="control-section">
				<h3>Model Controls</h3>
				<div class="control-row">
					<button @onclick="CreateSphere">Kugel</button>
					<button @onclick="CreateCube">Würfel</button>
					<button @onclick="CreateCylinder">Zylinder</button>
					<button @onclick="CreateCone">Kegel</button>
				</div>
			</div>

			<div class="control-section">
				<h3>Zoom & Rotation</h3>
				<label>
					<input type="checkbox" @bind="EnableZoom" />
					Zoom mit Mausrad aktivieren
				</label>
				<label>
					<input type="checkbox" @bind="EnableRotation" />
					Rotation mit Maus aktivieren
				</label>
				<label>
					<input type="checkbox" @bind="AutoRotate" />
					Auto-Rotation
				</label>
			</div>

			<div class="control-section">
				<h3>Größe: @ModelScale.ToString("F2")</h3>
				<input type="range" min="0.1" max="5.0" step="0.1" @bind="ModelScale" />
			</div>

			<div class="control-section">
				<h3>Auto-Rotation Speed: @AutoRotateSpeed.ToString("F0")°/s</h3>
				<input type="range" min="0" max="180" step="5" @bind="AutoRotateSpeed" />
			</div>

			<div class="control-section">
				<h3>Farbe</h3>
				<div class="color-buttons">
					<button class="color-btn red" @onclick="@(() => ModelTint = Color.Red)">Rot</button>
					<button class="color-btn green" @onclick="@(() => ModelTint = Color.Green)">Grün</button>
					<button class="color-btn blue" @onclick="@(() => ModelTint = Color.Blue)">Blau</button>
					<button class="color-btn white" @onclick="@(() => ModelTint = Color.White)">Weiß</button>
					<button class="color-btn yellow" @onclick="@(() => ModelTint = Color.Yellow)">Gelb</button>
					<button class="color-btn cyan" @onclick="@(() => ModelTint = Color.Cyan)">Cyan</button>
				</div>
			</div>

			<div class="control-section">
				<div class="info">
					<p><strong>Steuerung:</strong></p>
					<ul>
						<li>Mausrad: Vergrößern/Verkleinern</li>
						<li>Linke Maustaste ziehen: Rotieren</li>
						<li>Buttons: Form ändern</li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</root>

<style>
	.model3d-demo {
		width: 100%;
		height: 100%;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		padding: 20px;
	}

	.demo-container {
		display: flex;
		gap: 20px;
		height: 100%;
	}

	.model-viewer {
		flex: 2;
		background: rgba(0, 0, 0, 0.3);
		border-radius: 12px;
		overflow: hidden;
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
		border: 2px solid rgba(255, 255, 255, 0.1);
	}

	.controls {
		flex: 1;
		background: rgba(255, 255, 255, 0.95);
		border-radius: 12px;
		padding: 20px;
		overflow-y: auto;
		box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
		max-width: 400px;
	}

	.controls h2 {
		margin: 0 0 20px 0;
		color: #333;
		font-size: 24px;
		font-weight: bold;
	}

	.controls h3 {
		margin: 0 0 10px 0;
		color: #555;
		font-size: 16px;
		font-weight: 600;
	}

	.control-section {
		margin-bottom: 20px;
		padding-bottom: 20px;
		border-bottom: 1px solid rgba(0, 0, 0, 0.1);
	}

	.control-section:last-child {
		border-bottom: none;
	}

	.control-row {
		display: flex;
		gap: 10px;
		flex-wrap: wrap;
	}

	button {
		padding: 10px 20px;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		color: white;
		border: none;
		border-radius: 6px;
		cursor: pointer;
		font-size: 14px;
		font-weight: 600;
		transition: all 0.3s ease;
		box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
	}

	button:hover {
		transform: translateY(-2px);
		box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
	}

	button:active {
		transform: translateY(0);
	}

	label {
		display: flex;
		align-items: center;
		gap: 8px;
		margin-bottom: 8px;
		color: #555;
		font-size: 14px;
		cursor: pointer;
	}

	input[type="checkbox"] {
		width: 18px;
		height: 18px;
		cursor: pointer;
	}

	input[type="range"] {
		width: 100%;
		height: 6px;
		border-radius: 3px;
		background: rgba(0, 0, 0, 0.1);
		outline: none;
		cursor: pointer;
	}

	input[type="range"]::-webkit-slider-thumb {
		-webkit-appearance: none;
		appearance: none;
		width: 20px;
		height: 20px;
		border-radius: 50%;
		background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
		cursor: pointer;
		box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
	}

	.color-buttons {
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		gap: 8px;
	}

	.color-btn {
		padding: 12px;
		font-size: 12px;
		border-radius: 8px;
	}

	.color-btn.red {
		background: linear-gradient(135deg, #ff6b6b, #c92a2a);
	}

	.color-btn.green {
		background: linear-gradient(135deg, #51cf66, #2f9e44);
	}

	.color-btn.blue {
		background: linear-gradient(135deg, #339af0, #1864ab);
	}

	.color-btn.white {
		background: linear-gradient(135deg, #f1f3f5, #adb5bd);
		color: #333;
	}

	.color-btn.yellow {
		background: linear-gradient(135deg, #ffd43b, #fab005);
	}

	.color-btn.cyan {
		background: linear-gradient(135deg, #3bc9db, #1098ad);
	}

	.info {
		background: rgba(102, 126, 234, 0.1);
		padding: 15px;
		border-radius: 8px;
		color: #555;
		font-size: 13px;
	}

	.info p {
		margin: 0 0 10px 0;
		font-weight: 600;
	}

	.info ul {
		margin: 0;
		padding-left: 20px;
	}

	.info li {
		margin-bottom: 5px;
	}
</style>

@code
{
	private Model3DPanel modelPanel;

	[Property] public Model SelectedModel { get; set; }
	[Property] public Material SelectedMaterial { get; set; }
	[Property] public Color ModelTint { get; set; } = Color.White;
	[Property] public float ModelScale { get; set; } = 1.0f;
	[Property] public bool EnableRotation { get; set; } = true;
	[Property] public bool EnableZoom { get; set; } = true;
	[Property] public bool AutoRotate { get; set; } = false;
	[Property] public float AutoRotateSpeed { get; set; } = 30.0f;

	protected override void OnStart()
	{
		base.OnStart();
		CreateSphere(); // Start with a sphere
	}

	protected override int BuildHash()
	{
		return HashCode.Combine(
			SelectedModel,
			SelectedMaterial,
			ModelTint,
			ModelScale,
			EnableRotation,
			EnableZoom,
			AutoRotate,
			AutoRotateSpeed
		);
	}

	void CreateSphere()
	{
		var builder = Model.Builder;
		builder.AddSphere( Vector3.Zero, 50.0f, 32, 32 );
		SelectedModel = builder.Create();
		Log.Info( "Created sphere model" );
	}

	void CreateCube()
	{
		var builder = Model.Builder;
		builder.AddCube( new Vector3( 0, 0, 0 ), new Vector3( 80, 80, 80 ), Rotation.Identity );
		SelectedModel = builder.Create();
		Log.Info( "Created cube model" );
	}

	void CreateCylinder()
	{
		var builder = Model.Builder;
		
		// Create cylinder using circles
		var radius = 40.0f;
		var height = 100.0f;
		var segments = 32;
		
		// Top and bottom circles
		var topCenter = new Vector3( 0, 0, height / 2 );
		var bottomCenter = new Vector3( 0, 0, -height / 2 );
		
		// Create cylinder sides
		for ( int i = 0; i < segments; i++ )
		{
			float angle1 = (i / (float)segments) * MathF.PI * 2;
			float angle2 = ((i + 1) / (float)segments) * MathF.PI * 2;
			
			var x1 = MathF.Cos( angle1 ) * radius;
			var y1 = MathF.Sin( angle1 ) * radius;
			var x2 = MathF.Cos( angle2 ) * radius;
			var y2 = MathF.Sin( angle2 ) * radius;
			
			var p1Top = topCenter + new Vector3( x1, y1, 0 );
			var p2Top = topCenter + new Vector3( x2, y2, 0 );
			var p1Bottom = bottomCenter + new Vector3( x1, y1, 0 );
			var p2Bottom = bottomCenter + new Vector3( x2, y2, 0 );
			
			// Side quads (as triangles)
			builder.AddTriangle( p1Top, p2Top, p2Bottom );
			builder.AddTriangle( p1Top, p2Bottom, p1Bottom );
			
			// Top cap
			builder.AddTriangle( topCenter, p2Top, p1Top );
			
			// Bottom cap
			builder.AddTriangle( bottomCenter, p1Bottom, p2Bottom );
		}
		
		SelectedModel = builder.Create();
		Log.Info( "Created cylinder model" );
	}

	void CreateCone()
	{
		var builder = Model.Builder;
		
		var radius = 50.0f;
		var height = 100.0f;
		var segments = 32;
		
		var apex = new Vector3( 0, 0, height / 2 );
		var baseCenter = new Vector3( 0, 0, -height / 2 );
		
		for ( int i = 0; i < segments; i++ )
		{
			float angle1 = (i / (float)segments) * MathF.PI * 2;
			float angle2 = ((i + 1) / (float)segments) * MathF.PI * 2;
			
			var x1 = MathF.Cos( angle1 ) * radius;
			var y1 = MathF.Sin( angle1 ) * radius;
			var x2 = MathF.Cos( angle2 ) * radius;
			var y2 = MathF.Sin( angle2 ) * radius;
			
			var p1 = baseCenter + new Vector3( x1, y1, 0 );
			var p2 = baseCenter + new Vector3( x2, y2, 0 );
			
			// Side triangles
			builder.AddTriangle( apex, p2, p1 );
			
			// Base triangle
			builder.AddTriangle( baseCenter, p1, p2 );
		}
		
		SelectedModel = builder.Create();
		Log.Info( "Created cone model" );
	}
}
